<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Navbar H·ªá th·ªëng t·ªï ch·ª©c thi ch·ª©ng ch·ªâ</title>
    <link rel="stylesheet" href="/CSS/TraCuuSoLanGiaHan.css">
    <link rel="stylesheet" href="/CSS/Navbar.css">
</head>
<body>
    <div id="navbar-container"></div>
    <h1>Tra C·ª©u S·ªë L·∫ßn Gia H·∫°n</h1>
    <input type="text" id="search-box" placeholder="Nh·∫≠p CCCD">
    <input type="Date" id="date-box">
    <button id="search-btn" onclick="fetchData()">üîç</button>

    
    <table>
        <thead>
            <tr>
                <th>M√£ phi·∫øu</th>
                <th>CCCD</th>
                <th>Ng√†y Thi</th>
                <th>S·ªë l·∫ßn gia h·∫°n</th>
            </tr>
        </thead>
        <tbody id="table-body">
            <!-- D·ªØ li·ªáu s·∫Ω ƒë∆∞·ª£c hi·ªÉn th·ªã t·∫°i ƒë√¢y b·∫±ng JavaScript -->
            <td colspan="4">
                Vui l√≤ng nh·∫≠p th√¥ng tin ƒë·ªÉ tra c·ª©u
            </td>
        </tbody>
    </table>
    <button class="btn_Tra_cuu_PGH" onclick="window.location.href='TraCuuPhieuGiaHan.html'">
        Tra c·ª©u phi·∫øu gia h·∫°n
    </button>
    <button class="btn_Lap_Phieu_Gia_Han" onclick="window.location.href='LapPhieuGiaHan.html'">
        L·∫≠p phi·∫øu gia h·∫°n
    </button>

    <script src="/DangNhap/Navbar.js"></script>
    <script src="/GiaHan/GiaHan.js"></script>
    <script>
        async function fetchData() {
            const cccd = document.getElementById("search-box").value.trim();
            const date = document.getElementById("date-box").value;

            if (!cccd || !date) {
                alert("Vui l√≤ng nh·∫≠p ƒë·∫ßy ƒë·ªß CCCD v√† ng√†y thi.");
                return;
            }

            try {
                const response = await fetch('/api/TraCuuSoLanGiaHan', {
                    method: "POST",
                    headers: {
                        "Content-Type": "application/json"
                    },
                    body: JSON.stringify({ CCCD: cccd, NgayThi: date })
                });

                const result = await response.json();

                // N·∫øu API tr·∫£ l·ªói
                if (!response.ok) {
                    alert("L·ªói: " + result.error);
                    return;
                }

                // N·∫øu kh√¥ng c√≥ d·ªØ li·ªáu
                if (result.length === 0) {
                    alert("Kh√¥ng t√¨m th·∫•y d·ªØ li·ªáu.");
                    return;
                }

                // Hi·ªÉn th·ªã k·∫øt qu·∫£
                const tableBody = document.getElementById("table-body");
                tableBody.innerHTML = "";

                result.forEach(row => {
                    tableBody.innerHTML += `
                        <tr>
                            <td>${row.MaPhieuDangKy}</td>
                            <td>${row.CCCD}</td>
                            <td>${new Date(row.NgayThi).toLocaleDateString('vi-VN')}</td>
                            <td>${row.SoLanGiaHan}</td>
                        </tr>
                    `;
                });

            } catch (error) {
                alert("L·ªói h·ªá th·ªëng: " + error.message);
            }
        }
    </script>
</body>
</html>