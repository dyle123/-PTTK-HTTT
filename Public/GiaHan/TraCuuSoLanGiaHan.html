<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Navbar H·ªá th·ªëng t·ªï ch·ª©c thi ch·ª©ng ch·ªâ</title>
    <link rel="stylesheet" href="/CSS/TraCuuSoLanGiaHan.css">
    <link rel="stylesheet" href="/CSS/Navbar.css">
</head>
<body>
    <div id="navbar-container"></div>
    <h1>Tra C·ª©u S·ªë L·∫ßn Gia H·∫°n</h1>
    <input type="number" id="search-box" placeholder="Nh·∫≠p m√£ phi·∫øu ƒëƒÉng k√Ω" step="1">
    <button id="search-btn" onclick="fetchData()">üîç</button>

    
    <table>
        <thead>
            <tr>
                <th>M√£ phi·∫øu</th>
                <th>CCCD</th>
                <th>S·ªë l·∫ßn gia h·∫°n</th>
            </tr>
        </thead>
        <tbody id="table-body">
            <!-- D·ªØ li·ªáu s·∫Ω ƒë∆∞·ª£c hi·ªÉn th·ªã t·∫°i ƒë√¢y b·∫±ng JavaScript -->
        </tbody>
    </table>
    <button class="btn_Tra_cuu_PGH" onclick="window.location.href='TraCuuPhieuGiaHan.html'">
        Tra c·ª©u phi·∫øu gia h·∫°n
    </button>
    <button class="btn_Lap_Phieu_Gia_Han" onclick="window.location.href='LapPhieuGiaHan.html'">
        L·∫≠p phi·∫øu gia h·∫°n
    </button>

    <script src="/DangNhap/Navbar.js"></script>
    <script src="/GiaHan/GiaHan.js"></script>
    <script>
        document.getElementById("search-box").addEventListener("input", function(){
        this.value = this.value.replace(/[^0-9]/g, "");
        })

        async function fetchData() 
        {
            const maPhieu = document.getElementById('search-box').value;
            if (!maPhieu) {
                alert('Vui l√≤ng nh·∫≠p m√£ phi·∫øu ƒëƒÉng k√Ω!');
                return;
            }

            try {
                const response = await fetch(`/api/getChiTietPhieuDangKy?maPhieuDangKy=${maPhieu}`);
                const data = await response.json();

                const tableBody = document.getElementById('table-body');
                tableBody.innerHTML = '';

            if (data.error) {
                tableBody.innerHTML = '<tr><td colspan="3">Kh√¥ng t√¨m th·∫•y phi·∫øu ƒëƒÉng k√Ω</td></tr>';
            } else {
            data.forEach(item => {
                const row = `<tr>
                <td>${item.MaPhieuDangKy}</td>
                <td>${item.CCCD}</td>
                <td>${item.SoLanGiaHan}</td>
                </tr>`;
                tableBody.innerHTML += row;
            });
        }
        } catch (error) {
            console.error('L·ªói khi l·∫•y d·ªØ li·ªáu:', error);
            alert('C√≥ l·ªói x·∫£y ra, vui l√≤ng th·ª≠ l·∫°i!');
        }
    }
</script>
</body>
</html>