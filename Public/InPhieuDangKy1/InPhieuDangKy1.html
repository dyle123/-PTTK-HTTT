<!DOCTYPE html>
<html lang="vi">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>In Phi·∫øu ƒêƒÉng K√Ω</title>
    <link rel="stylesheet" href="/CSS/InPhieuDangKy.css">
    <link rel="stylesheet" href="/CSS/Transaction.css">
    <script src="/DangNhap/Transaction.js" defer></script>
    <script src="/DangNhap/Navbar.js" defer></script>
    <script src="/InPhieuDangKy1/InPhieuDangKy1.js" defer></script>

    <style>
        @media print {
            body *:not(#phieu-in) {
                display: none !important;
            }

            #phieu-in {
                display: block !important;
                margin: 0 auto;
            }
        }
    </style>

    <script>
        async function inPhieu(maPhieuDangKy) {
            try {
                const res = await fetch(`/api/getPhieuDangKy?maPhieu=${maPhieuDangKy}`);
                const phieu = (await res.json())[0];
                if (!phieu) {
                    alert("Kh√¥ng t√¨m th·∫•y phi·∫øu");
                    return;
                }

                const khachHang = await fetch(`/api/getKhachHangByPhieu?maPhieuDangKy=${maPhieuDangKy}`).then(r => r.json()).then(r => r[0]);
                const chiTiet = await fetch(`/api/getChiTietPhieuDangKy?maPhieuDangKy=${maPhieuDangKy}`).then(r => r.json()).then(r => r[0]);
                const thisinh = await fetch(`/api/getThisinhByCCCD?cccd=${chiTiet?.CCCD}`).then(r => r.json()).then(r => r[0]);

                const html = `
                    <div style="padding: 20px; font-family: Arial;">
                        <h2 style="text-align:center">PHI·∫æU ƒêƒÇNG K√ù D·ª∞ THI</h2>

                        <h3>1. Th√¥ng tin kh√°ch h√†ng</h3>
                        <p>H·ªç t√™n: ${khachHang?.TenKhachHang}</p>
                        <p>Email: ${khachHang?.Email}</p>
                        <p>SDT: ${khachHang?.SoDienThoai}</p>
                        <p>ƒê·ªãa ch·ªâ: ${khachHang?.DiaChi}</p>
                        <p>Lo·∫°i: ${khachHang?.LoaiKhachHang}</p>

                        <h3>2. Th√¥ng tin th√≠ sinh</h3>
                        <p>H·ªç t√™n: ${thisinh?.HoVaTen}</p>
                        <p>CCCD: ${thisinh?.CCCD}</p>
                        <p>Ng√†y sinh: ${thisinh?.NgaySinh}</p>
                        <p>Email: ${thisinh?.Email}</p>
                        <p>SDT: ${thisinh?.SoDienThoai}</p>
                        <p>ƒê·ªãa ch·ªâ: ${thisinh?.DiaChi}</p>

                        <h3>3. Th√¥ng tin phi·∫øu ƒëƒÉng k√Ω</h3>
                        <p>M√£ phi·∫øu: ${phieu.MaPhieuDangKy}</p>
                        <p>Ng√†y ƒëƒÉng k√Ω: ${phieu.NgayDangKy}</p>
                        <p>Ng√†y thi: ${phieu.NgayThi}</p>
                        <p>Gi·ªù thi: ${phieu.GioThi}</p>
                        <p>Ph√≤ng thi: ${phieu.MaPhongThi}</p>
                        <p>Lo·∫°i ch·ª©ng ch·ªâ: ${phieu.LoaiChungChi}</p>
                    </div>
                `;

                const container = document.getElementById("phieu-in");
                container.innerHTML = html;
                container.style.display = "block";

                setTimeout(() => {
                    window.print();
                    container.style.display = "none";
                }, 500);
            } catch (err) {
                alert("L·ªói khi in phi·∫øu: " + err.message);
            }
        }
    </script>
</head>

<body>
    <div id="navbar-container"></div>

    <h1>Danh S√°ch Phi·∫øu ƒêƒÉng K√Ω</h1>

    <div class="search-container">
        <input type="text" id="search-box" placeholder="T√¨m theo m√£ phi·∫øu">
        <button id="search-btn">üîç</button>
    </div>

    <table>
        <thead>
            <tr>
                <th>M√£ phi·∫øu</th>
                <th>Lo·∫°i ch·ª©ng ch·ªâ</th>
                <th>Ng√†y ƒëƒÉng k√Ω</th>
                <th>Th·ªùi gian thi ƒëƒÉng k√Ω</th>
                <th>M√£ kh√°ch h√†ng</th>
                <th>In phi·∫øu</th>
            </tr>
        </thead>
        <tbody id="table-body">
            <!-- D·ªØ li·ªáu s·∫Ω ƒë∆∞·ª£c render ·ªü JS, v√≠ d·ª• m·ªói d√≤ng c√≥ n√∫t:
            <button onclick="inPhieu(123)">üñ®Ô∏è In phi·∫øu</button>
            -->
        </tbody>
    </table>

    <!-- Ph·∫ßn in s·∫Ω render v√†o ƒë√¢y -->
    <div id="phieu-in" style="display:none"></div>
</body>

</html>